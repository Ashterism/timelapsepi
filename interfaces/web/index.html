<!DOCTYPE html>
<html>
<head>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>TimelapsePi</title>
  <link rel="stylesheet" href="/style.css">
</head>
<body>
  <main class="container">
    <div class="header">
      <div class="menu-icon">‚ò∞</div>
      <h1>Asheterix<br><span class="subtitle">Timelapse</span></h1>
      <img src="/astroPic.png" alt="Logo" class="header-logo">
    </div>

    <section class="section">
      <h2>Status</h2>
      <button onclick="takePhoto()">üì∏ Take Test Photo</button>
    </section>

    <section class="section">
      <h2>Photo Preview</h2>
      <img id="photo" src="" style="width: 100%; max-width: 400px;" alt="No photo yet" onerror="this.onerror=null; this.src='/interfaces/web/no-preview.png'; this.alt='No preview available';">
      <div id="fileInfo" style="font-size: 0.9rem; color: #555; margin-top: 0.5rem;"></div>
      <script>
        const photoEl = document.getElementById('photo');
        photoEl.src = `/latest.jpg?${Date.now()}`;

        fetch('/latest-timestamp')
        .then(res => res.text())
        .then(timestamp => {
          const date = new Date(timestamp); // Now an ISO 8601 string
          document.getElementById('fileInfo').textContent = `File: latest.jpg | Taken: ${date.toLocaleString()}`;
        });
      </script>  
    </section>

    <details class="config-box section">
      <summary>‚öôÔ∏è Timelapse Config</summary>
      <div class="config-content">
        <p>Timelapse settings will go here...</p>
      </div>
    </details>
  </main>

  <script src="/photo.js"></script>
  
  <!-- Inline script to update timestamp text under the preview image on page load -->
  <script>
    fetch('/latest-timestamp')
      .then(res => res.text())
      .then(timestamp => {
        const date = new Date(parseInt(timestamp) * 1000);
        document.getElementById('fileInfo').textContent = `File: latest.jpg | Taken: ${date.toLocaleString()}`;
      });
  </script>
</body>
</html>