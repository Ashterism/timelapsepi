<!DOCTYPE html>
<html>
<head>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>TimelapsePi</title>
  <link rel="stylesheet" href="/static/style.css">
  <link rel="icon" href="/static/favicon.ico" type="image/x-icon" />
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/glightbox/dist/css/glightbox.min.css" />
</head>
<body>
  <!-- GLightbox JS -->
<script src="https://cdn.jsdelivr.net/npm/glightbox/dist/js/glightbox.min.js"></script>
  <main class="container">
    <div id="sideMenu" class="side-menu">
      <ul>
        <li><a href="#">Dashboard</a></li>
        <li><a href="#">Archive</a></li>
        <li><a href="#">Settings</a></li>
        <li><a href="#">Connection</a></li>
      </ul>
    </div>
    <div class="header">
      <div class="menu-icon">‚ò∞</div>
      <h1>Ashterix<br><span class="subtitle">Timelapse</span></h1>
      <img src="/static/astroPic.png" alt="Logo" class="header-logo">
    </div>

    <div class="accordion">
      <button class="accordion-button">üì∏ Status</button>
      <div class="accordion-content">
        <div id="system-status" class="metadata-block">
          <div style="display: flex; gap: 2rem;">
            <div style="flex: 1;">
              <p class="meta-label"><strong>Battery:</strong> <span id="battery-status">Loading...</span></p>
            </div>
            <div style="flex: 1;">
              <p class="meta-label"><strong>Connection:</strong> <span id="connection-status">Loading...</span></p>
            </div>
          </div>
          <p class="meta-label"><strong>IP:</strong> <span id="ip-address">Loading...</span></p>
        </div>
      </div>
    </div>

    <div class="accordion">
      <button class="accordion-button">üñºÔ∏è Preview Timelapse Framing</button>
      <div class="accordion-content">
        <img id="preview-img" src="/latest.jpg" style="width: 100%; max-width: 400px;" alt="No photo yet" onerror="this.onerror=null; this.src='/static/no-preview.png'; this.alt='No preview available';">
        <div id="photo-metadata" class="metadata-block">
          <p class="meta-label"><strong>Timestamp:</strong> <span id="meta-timestamp">Loading...</span></p>
          <div class="meta-columns">
            <div class="meta-col-left">
              <p class="meta-label"><strong>ISO:</strong> <span id="meta-iso">Loading...</span></p>
              <p class="meta-label"><strong>Shutter:</strong> <span id="meta-shutter">Loading...</span></p>
              <p class="meta-label"><strong>Aperture:</strong> <span id="meta-aperture">Loading...</span></p>
            </div>
            <div class="meta-col-right">
              <p class="meta-label"><strong>File Size:</strong> <span id="meta-filesize">Loading...</span></p>
              <p class="meta-label"><strong>Resolution:</strong> <span id="meta-resolution">Loading...</span></p>
            </div>
          </div>
        </div>
        <button onclick="takePhoto()">üì∏ Take Test Photo</button>
      </div>
    </div>

    <div class="accordion">
      <button class="accordion-button">‚öôÔ∏è Timelapse Config</button>
      <div class="accordion-content">
        <div class="form-block">
          <label for="interval">Interval <span class="hint">(hh:mm:ss)</span></label>
          <input type="text" id="interval" name="interval" placeholder="00:01:00" />

          <label for="start-time">Start Time <span class="hint">(ISO or blank for now)</span></label>
          <input type="text" id="start-time" name="start-time" placeholder="2025-04-25T13:00" />

          <label for="end-count">End Condition:</label>
          <div class="radio-row">
            <input type="radio" id="end-count" name="end-type" value="photo_count" checked />
            <label for="end-count">Number of Photos</label>

            <input type="radio" id="end-time" name="end-type" value="end_time" />
            <label for="end-time">End Time</label>
          </div>

          <div id="end-count-group">
            <label for="photo-count">Number of Photos:</label>
            <input type="number" id="photo-count" name="photo-count" placeholder="e.g., 1200" />
          </div>

          <div id="end-time-group" style="display:none;">
            <label for="end-time-input">End Time:</label>
            <input type="text" id="end-time-input" name="end-time-input" placeholder="2025-04-25T15:00" />
          </div>

          <label for="folder-name">Folder Name <span class="hint">(leave blank for timestamp)</span></label>
          <input type="text" id="folder-name" name="folder-name" placeholder="Leave blank to auto-generate" />

          <button onclick="startTimelapse()">üöÄ Start Timelapse</button>
          <button onclick="stopTimelapse()">üõë Stop Timelapse</button>
          
        </div>
      </div>
    </div>

   <div class="accordion">
    <button class="accordion-button">üìΩÔ∏è Active Timelapse</button>
      <div class="accordion-content">
        <p>ONLY VISIBLE WHEN ACTIVE - hide preview and config</p>
        <p>This section shows the iamges from the timelapse.</p>
        <p>Including number of images taken so far</p>
        <p>list of images taken - option to select one and open lightbox</p>
      </div>
    </div>

    <div class="accordion">
      <button class="accordion-button">üì¶ Timelapse Archive</button>
      <div class="accordion-content">
        <p> NO ACTIVE SESSION</p>
        <p> ....or....</p>
        <p>This section has drop down of folders of sessions.</p>
        <p>and then the same functionality as above to thumbnail</p>
        <p>future functionality is select one and create timelapse</p>

        <!-- Dropdown -->
        <label for="sessionDropdown">Select a Session <span class="hint">(choose from previous runs)</span></label>
        <br>
        <select id="sessionDropdown" class="form-input">
          <option value="">-- Choose a session --</option>
        </select>

        <div id="sessionDetails" class="metadata-block" style="display:none;">
          <p class="meta-label"><strong>Folder:</strong> <span id="detail-folder">-</span></p>
          <p class="meta-label"><strong>Started:</strong> <span id="detail-started">-</span></p>
          <p class="meta-label"><strong>Interval:</strong> <span id="detail-interval">-</span></p>
          <p class="meta-label"><strong>Image Count:</strong> <span id="detail-imagecount">-</span></p>
        </div>

        <div id="imagePreview" style="margin-top:1rem; display:none;">
          <h4>Images</h4>
          <div id="imageGrid" style="display: flex; flex-wrap: wrap; gap: 8px;"></div>
        </div>

      </div>
    </div>
  </main>

<script src="/static/scripts.js"></script>

</body>
</html>